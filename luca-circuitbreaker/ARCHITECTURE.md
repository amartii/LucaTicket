# ARQUITECTURA - LUCA Circuit Breaker

## Diagrama General del Sistema

```
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   CLIENTES EXTERNOS              â”‚
                          â”‚  (Frontend, MÃ³vil, etc)          â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â†“
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   API GATEWAY                    â”‚
                          â”‚   (luca-gateway:8282)            â”‚
                          â”‚                                  â”‚
                          â”‚  Enrutamiento y composiciÃ³n      â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚          â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                             â”‚
                    â†“                                             â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  EVENTOS SERVICE      â”‚                  â”‚  COMPRA SERVICE       â”‚
        â”‚  (eventos-service)    â”‚                  â”‚  (compra-service)     â”‚
        â”‚  Puerto: 8081         â”‚                  â”‚  Puerto: 8082         â”‚
        â”‚                       â”‚                  â”‚                       â”‚
        â”‚  âœ“ Disponible         â”‚                  â”‚  âœ“ Disponible         â”‚
        â”‚  âœ“ Registrado Eureka  â”‚                  â”‚  âœ“ Registrado Eureka  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                                          â”‚
                    â”‚                                          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  LUCA CIRCUIT BREAKER              â”‚
                    â”‚  (luca-circuitbreaker:8083)        â”‚
                    â”‚                                    â”‚
                    â”‚  ğŸ”§ ProtecciÃ³n Inteligente         â”‚
                    â”‚  ğŸ›¡ï¸  Resilencia                    â”‚
                    â”‚  ğŸ“Š Monitoreo                      â”‚
                    â”‚  ğŸ”„ Fallback                       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                              â†“             â†“
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ CLIENTE  â”‚  â”‚ CLIENTE  â”‚
                        â”‚ HTTP     â”‚  â”‚ HTTP     â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flujo de Solicitud Detallado

### Caso 1: Servicio Disponible (CLOSED)

```
CLIENTE
  â”‚
  â”‚ GET /api/eventos/1
  â†“
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ CircuitBreakerController            â•‘
â•‘                                     â•‘
â•‘  getEvento(1)                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  â”‚
  â†“
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ EventosServiceWrapper               â•‘
â•‘                                     â•‘
â•‘  @CircuitBreaker                    â•‘
â•‘  getEvento(1)                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  â”‚
  â†“ [Circuit CLOSED - normal operation]
  â”‚
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ EventosServiceFeignClient           â•‘
â•‘                                     â•‘
â•‘  getEvento(1)                       â•‘
â•‘  â†’ HTTP GET http://eventos-service:8081/eventos/1
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  â”‚
  â†“ [200 OK]
  â”‚
CLIENTE â† JSON: { "id": 1, "nombre": "Concert", ... }
          HTTP 200
```

### Caso 2: Servicio CaÃ­do (OPEN)

```
CLIENTE
  â”‚
  â”‚ GET /api/eventos/1
  â†“
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ CircuitBreakerController            â•‘
â•‘                                     â•‘
â•‘  getEvento(1)                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  â”‚
  â†“
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ EventosServiceWrapper               â•‘
â•‘                                     â•‘
â•‘  @CircuitBreaker                    â•‘
â•‘  getEvento(1)                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  â”‚
  â†“ [Circuit OPEN - too many failures]
  â”‚
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ fallbackGetEvento(1)                â•‘
â•‘                                     â•‘
â•‘  return null;                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  â”‚
  â†“
CLIENTE â† JSON: "Servicio no disponible..."
          HTTP 503 SERVICE UNAVAILABLE
```

### Caso 3: RecuperaciÃ³n (HALF_OPEN)

```
[0s]   Circuit OPEN
       Esperando 5s...

[5s]   Circuit â†’ HALF_OPEN
       Permitiendo 3 llamadas de prueba

[5.1s] CLIENTE â†’ GET /api/eventos/1
       â”‚
       â†“ [Llamada 1 - Ã‰XITO]
     
[5.2s] CLIENTE â†’ GET /api/eventos/2
       â”‚
       â†“ [Llamada 2 - Ã‰XITO]
     
[5.3s] CLIENTE â†’ GET /api/eventos/3
       â”‚
       â†“ [Llamada 3 - Ã‰XITO]
     
[5.4s] Todas las pruebas exitosas
       Circuit â†’ CLOSED
     
[5.5s] OperaciÃ³n normal restaurada âœ“
```

---

## Componentes Internos del Circuit Breaker

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            LUCA CIRCUIT BREAKER (8083)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  CircuitBreakerController                â”‚          â”‚
â”‚  â”‚  â”œâ”€ GET /api/eventos/{id}               â”‚          â”‚
â”‚  â”‚  â”œâ”€ GET /api/eventos                    â”‚          â”‚
â”‚  â”‚  â”œâ”€ POST /api/eventos                   â”‚          â”‚
â”‚  â”‚  â”œâ”€ GET /api/compras/{id}               â”‚          â”‚
â”‚  â”‚  â”œâ”€ GET /api/compras                    â”‚          â”‚
â”‚  â”‚  â”œâ”€ POST /api/compras                   â”‚          â”‚
â”‚  â”‚  â””â”€ GET /api/health                     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                        â”‚                               â”‚
â”‚                        â†“                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Service Wrappers                        â”‚          â”‚
â”‚  â”‚  â”œâ”€ EventosServiceWrapper                â”‚          â”‚
â”‚  â”‚  â”‚  â”œâ”€ @CircuitBreaker(eventosServiceCB)â”‚
â”‚  â”‚  â”‚  â”œâ”€ fallbackGetEvento()              â”‚          â”‚
â”‚  â”‚  â”‚  â”œâ”€ fallbackGetAllEventos()          â”‚          â”‚
â”‚  â”‚  â”‚  â””â”€ fallbackCreateEvento()           â”‚          â”‚
â”‚  â”‚  â”‚                                      â”‚          â”‚
â”‚  â”‚  â””â”€ CompraServiceWrapper                â”‚          â”‚
â”‚  â”‚     â”œâ”€ @CircuitBreaker(compraServiceCB)â”‚
â”‚  â”‚     â”œâ”€ fallbackGetCompra()              â”‚          â”‚
â”‚  â”‚     â”œâ”€ fallbackGetAllCompras()          â”‚          â”‚
â”‚  â”‚     â””â”€ fallbackProcesarCompra()         â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                        â”‚                               â”‚
â”‚                        â†“                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Feign Clients                           â”‚          â”‚
â”‚  â”‚  â”œâ”€ EventosServiceFeignClient            â”‚          â”‚
â”‚  â”‚  â”‚  @FeignClient(name="eventos-service")â”‚
â”‚  â”‚  â”‚                                      â”‚          â”‚
â”‚  â”‚  â””â”€ CompraServiceFeignClient            â”‚          â”‚
â”‚  â”‚     @FeignClient(name="compra-service") â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                        â”‚                               â”‚
â”‚                        â†“                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Resilience4j                            â”‚          â”‚
â”‚  â”‚  â”œâ”€ CircuitBreakerRegistry               â”‚          â”‚
â”‚  â”‚  â”‚  â”œâ”€ eventosServiceCB                  â”‚          â”‚
â”‚  â”‚  â”‚  â””â”€ compraServiceCB                   â”‚          â”‚
â”‚  â”‚  â”‚                                      â”‚          â”‚
â”‚  â”‚  â”œâ”€ Retry Policy                        â”‚          â”‚
â”‚  â”‚  â”‚  â””â”€ max-attempts: 3                  â”‚          â”‚
â”‚  â”‚  â”‚                                      â”‚          â”‚
â”‚  â”‚  â””â”€ TimeLimit                           â”‚          â”‚
â”‚  â”‚     â””â”€ timeout: 5s                      â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                        â”‚                               â”‚
â”‚                        â†“                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Observability                           â”‚          â”‚
â”‚  â”‚  â”œâ”€ Health Indicators                    â”‚          â”‚
â”‚  â”‚  â”œâ”€ Metrics (Prometheus)                 â”‚          â”‚
â”‚  â”‚  â”œâ”€ Actuator Endpoints                   â”‚          â”‚
â”‚  â”‚  â””â”€ Logging (SLF4J)                      â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## InteracciÃ³n con Eureka

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    EUREKA SERVER (8761)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Registered Services:          â”‚ â”‚
â”‚  â”‚  âœ“ eventos-service (8081)      â”‚ â”‚
â”‚  â”‚  âœ“ compra-service (8082)       â”‚ â”‚
â”‚  â”‚  âœ“ luca-circuitbreaker (8083)  â”‚ â”‚
â”‚  â”‚  âœ“ luca-gateway (8282)         â”‚ â”‚
â”‚  â”‚  âœ“ eureka-server (8761)        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†‘                       â†‘
       â”‚                       â”‚
    Register            Discover
    Health check         Load balance
       â”‚                       â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LUCA CIRCUIT BREAKER (8083)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  Feign Client Lookup:                â”‚
â”‚  â€¢ name="eventos-service"            â”‚
â”‚    â†’ Eureka: find eventos-service    â”‚
â”‚    â†’ Get instance: 127.0.0.1:8081   â”‚
â”‚                                      â”‚
â”‚  â€¢ name="compra-service"             â”‚
â”‚    â†’ Eureka: find compra-service     â”‚
â”‚    â†’ Get instance: 127.0.0.1:8082   â”‚
â”‚                                      â”‚
â”‚  Load Balancing:                     â”‚
â”‚  â€¢ lb://eventos-service (multiple instances)
â”‚  â€¢ lb://compra-service (multiple instances)
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Estados del Circuit Breaker

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CIRCUIT BREAKER STATE MACHINE              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ CLOSED  â”‚ â† Estado inicial
                        â”‚ ğŸŸ¢      â”‚
                        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                             â”‚
                    failureRate > threshold
                             â”‚
                             â†“
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ OPEN    â”‚ â† Rechaza llamadas
                        â”‚ ğŸ”´      â”‚   Usa fallback
                        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                             â”‚
                   waitDurationInOpenState elapsed
                             â”‚
                             â†“
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ HALF_OPEN    â”‚ â† Testea recuperaciÃ³n
                        â”‚ ğŸŸ¡           â”‚
                        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                             â”‚    â”‚
              Success en    â”‚    â”‚ Fallo en
              todas las     â”‚    â”‚ pruebas
              pruebas       â”‚    â”‚
                             â”‚    â”‚
                        â”Œâ”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”
                        â†“              â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ CLOSED  â”‚    â”‚ OPEN    â”‚
                    â”‚ ğŸŸ¢      â”‚    â”‚ ğŸ”´      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flujo de Datos Detallado

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    REQUEST FLOW                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. HTTP Request
   GET /api/eventos/1
   â”‚
   â†“

2. CircuitBreakerController
   @GetMapping("/eventos/{id}")
   â”‚
   â”œâ”€ Log: "GET /api/eventos/1"
   â”‚
   â†“

3. EventosServiceWrapper.getEvento(1)
   @CircuitBreaker(name = "eventosServiceCB")
   â”‚
   â”œâ”€ Check: Â¿Circuit estÃ¡ OPEN?
   â”‚  â”œâ”€ SÃ  â†’ Ir a fallback
   â”‚  â””â”€ NO  â†’ Continuar
   â”‚
   â†“

4. EventosServiceFeignClient.getEvento(1)
   @FeignClient(name = "eventos-service")
   â”‚
   â”œâ”€ Eureka Lookup: "eventos-service"
   â”œâ”€ Load Balance: Choose instance
   â”œâ”€ HTTP GET http://eventos-service:8081/eventos/1
   â”‚
   â†“

5. Response
   â”œâ”€ 200 OK â†’ Registrar Ã©xito
   â”œâ”€ 4xx Error â†’ Registrar fallo
   â””â”€ 5xx Error â†’ Registrar fallo
   â”‚
   â†“

6. Circuit Breaker Evaluation
   â”œâ”€ Count failures
   â”œâ”€ Calculate failureRate
   â”œâ”€ If failureRate > threshold:
   â”‚  â””â”€ Open circuit (CLOSED â†’ OPEN)
   â”‚
   â†“

7. Response Handler
   â”œâ”€ If success: return data
   â””â”€ If failure: call fallback
   â”‚
   â†“

8. HTTP Response
   â”œâ”€ 200 OK + JSON data
   â””â”€ 503 Service Unavailable
```

---

## ConfiguraciÃ³n de Resilience4j

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         RESILIENCE4J CONFIGURATION                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Resilience4j
â”‚
â”œâ”€ CircuitBreaker
â”‚  â”‚
â”‚  â”œâ”€ Instance: eventosServiceCB
â”‚  â”‚  â”œâ”€ slidingWindowSize: 10
â”‚  â”‚  â”‚  â””â”€ Considera Ãºltimas 10 llamadas
â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€ failureRateThreshold: 50
â”‚  â”‚  â”‚  â””â”€ Si 50%+ fallan â†’ OPEN
â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€ waitDurationInOpenState: 5s
â”‚  â”‚  â”‚  â””â”€ Espera 5s antes de HALF_OPEN
â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€ permittedNumberOfCallsInHalfOpenState: 3
â”‚  â”‚  â”‚  â””â”€ 3 llamadas en HALF_OPEN
â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€ minimumNumberOfCalls: 4
â”‚  â”‚     â””â”€ MÃ­nimo 4 para evaluar
â”‚  â”‚
â”‚  â””â”€ Instance: compraServiceCB
â”‚     â””â”€ (Mismo patrÃ³n)
â”‚
â”œâ”€ Retry
â”‚  â”œâ”€ max-attempts: 3
â”‚  â””â”€ wait-duration: 1000ms
â”‚
â””â”€ TimeLimiter
   â”œâ”€ timeout-duration: 5s
   â””â”€ cancel-running-future: true
```

---

## IntegraciÃ³n Completa

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ARCHITECTURE OVERVIEW                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User / Client Applications
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Gateway (luca-gateway)             â”‚
â”‚  Enrutamiento, ComposiciÃ³n              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  route: /eventos/** â†’ eventos-service   â”‚
â”‚  route: /pasarela/** â†’ compra-service   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ eventos-service â”‚  â”‚ compra-service  â”‚
â”‚ (8081)          â”‚  â”‚ (8082)          â”‚
â”‚ Eureka Client   â”‚  â”‚ Eureka Client   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚
         â”‚  (Optional)        â”‚ (Optional)
         â”‚  Usar a travÃ©s de: â”‚ Usar a travÃ©s de:
         â”‚  Circuit Breaker   â”‚ Circuit Breaker
         â”‚                    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ LUCA CIRCUIT BREAKER (8083)  â”‚
        â”‚ â€¢ Resilencia                 â”‚
        â”‚ â€¢ Fallback                   â”‚
        â”‚ â€¢ Monitoreo                  â”‚
        â”‚ â€¢ Service Discovery          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â†“                    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ MÃ©tricas â”‚        â”‚ Health   â”‚
    â”‚ Logs     â”‚        â”‚ Alerts   â”‚
    â”‚ Traces   â”‚        â”‚          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Monitoring Stack (Future)        â”‚
    â”‚ â€¢ Prometheus                    â”‚
    â”‚ â€¢ Grafana                       â”‚
    â”‚ â€¢ ELK Stack                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
